# BLHeli_S 流程图索引（SVG版本）

本文档列出了所有为 BLHeli_S.asm 创建的流程图文件及其描述。这些流程图已经从DOT语言转换为SVG格式，可以直接在支持SVG的浏览器或图像查看器中查看。

## 流程图文件列表

1. **主流程图** - `main_flow.svg`
   - 描述：BLHeli_S 固件的主要流程，包括初始化、信号检测、武装、等待加电和电机运行等主要阶段。
   - 内容：系统初始化、信号检测、武装流程、等待加电、电机启动和运行的主要状态转换。
   - [查看主流程图](main_flow.svg)

2. **启动和初始化流程图** - `startup_flow.svg`
   - 描述：详细展示系统启动和初始化过程，包括参数读取、信号类型检测和校准等。
   - 内容：系统初始化、参数读取、信号类型自动检测、油门校准和编程模式等流程。
   - [查看启动和初始化流程图](startup_flow.svg)

3. **零交叉检测和换向流程图** - `zc_comm_flow.svg`
   - 描述：详细展示零交叉检测和电机换向的处理流程。
   - 内容：零交叉扫描、比较器检测、换向时序调整和换向执行等关键步骤。
   - [查看零交叉检测和换向流程图](zc_comm_flow.svg)

4. **运行阶段流程图** - `run_phase_flow.svg`
   - 描述：详细展示电机正常运行时的六步换向和状态检查流程。
   - 内容：六个运行阶段、启动阶段检查、初始运行阶段检查、双向模式处理和方向变化处理等。
   - [查看运行阶段流程图](run_phase_flow.svg)

5. **中断处理流程图** - `interrupt_flow.svg`
   - 描述：详细展示各种中断的处理逻辑，包括定时器中断和外部中断。
   - 内容：Timer0-3中断、外部中断0和PCA中断的处理流程，包括RC脉冲捕获、DShot解码、换向和零交叉检测等。
   - [查看中断处理流程图](interrupt_flow.svg)

6. **DShot命令处理流程图** - `dshot_flow.svg`
   - 描述：详细展示DShot命令的处理逻辑，包括蜂鸣、方向控制和保存设置等命令。
   - 内容：DShot命令解析、命令计数器处理、蜂鸣命令、方向命令和保存设置命令的处理流程。
   - [查看DShot命令处理流程图](dshot_flow.svg)

7. **换相时序计算流程图** - `timing_flow.svg`
   - 描述：详细展示calc_next_comm_timing函数的逻辑，说明如何计算换相时序和零交叉检测时间。
   - 内容：换相时间存储、平均时间计算、电角度时间计算、零交叉扫描延时设置、提前换相定时设置等。
   - [查看换相时序计算流程图](timing_flow.svg)

## 使用方法

1. 直接在浏览器中查看：
   - 点击上面的链接可以直接在支持SVG的浏览器中查看流程图
   - 大多数现代浏览器（Chrome、Firefox、Safari、Edge等）都支持SVG格式

2. 使用图像查看器：
   - SVG文件可以使用支持矢量图形的图像查看器打开
   - 推荐使用Inkscape、Adobe Illustrator或其他支持SVG的软件进行查看和编辑

3. 嵌入到HTML文档：
   - SVG文件可以直接嵌入到HTML文档中
   - 例如：`<img src="main_flow.svg" alt="主流程图">`

## SVG格式的优势

- **矢量图形**：SVG是一种矢量图形格式，可以无损缩放，不会像位图那样在放大时变得模糊
- **文件小**：SVG文件通常比同等质量的位图文件（如PNG、JPEG）小得多
- **可编辑**：SVG文件可以使用文本编辑器或矢量图形编辑软件进行编辑
- **可搜索**：SVG中的文本是可搜索的，便于在大型图表中查找特定内容
- **可访问性**：SVG支持辅助技术，有利于提高可访问性

## 流程图之间的关系

- **主流程图**（main_flow.svg）提供了整个系统的高级概览。
- **启动和初始化流程图**（startup_flow.svg）详细展示了主流程图中初始化和信号检测部分。
- **零交叉检测和换向流程图**（zc_comm_flow.svg）详细展示了电机控制的核心算法。
- **运行阶段流程图**（run_phase_flow.svg）详细展示了电机正常运行时的状态转换。
- **中断处理流程图**（interrupt_flow.svg）展示了各种中断如何支持主流程的执行。
- **DShot命令处理流程图**（dshot_flow.svg）详细展示了DShot数字信号的命令处理逻辑。
- **换相时序计算流程图**（timing_flow.svg）详细展示了换相时序计算的核心算法，包括电角度时间计算和零交叉检测时序。

## 原始DOT文件

如果您需要修改流程图，原始的DOT文件仍然保留在同一目录中：

- `main_flow.dot`
- `startup_flow.dot`
- `zc_comm_flow.dot`
- `run_phase_flow.dot`
- `interrupt_flow.dot`
- `dshot_flow.dot`
- `timing_flow.dot`

您可以使用Graphviz工具对这些DOT文件进行编辑和重新生成SVG：

```bash
dot -Tsvg input.dot -o output.svg
```